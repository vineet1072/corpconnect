import { useState, useRef, useEffect } from "react";

// ─── NAV DATA ─────────────────────────────────────────────────────────────────
const NAV_DATA = [
  {
    label: "Registrations",
    sections: [
      {
        title: "Company Registration",
        links: [
          "Company Registration", "Private Limited Company Registration",
          "LLP Registration", "Public Limited Company Registration",
          "Partnership Firm Registration", "NGO Registration",
          "Trust Registration", "Sole Proprietorship Registration",
          "OPC Registration", "Society Registration",
          "Startup India Registration", "Virtual Office",
          "Nidhi Company Registration", "Section 8 Company Registration",
          "Indian Subsidiary Registration", "Foreign Company Registration",
        ],
      },
      {
        title: "Government Registration",
        links: [
          "Drug License", "ISO Registration", "Ayush License",
          "Medical Device Registration", "Professional Tax Registration",
          "Factory License", "ISO 9001 Certification", "ISO 27001 Certification",
          "ISO 14001 Certification", "GMP Certification",
          "Geographical Indication Registration", "Petrol Pump License",
        ],
      },
      {
        title: "FSSAI Registration",
        links: [
          "FSSAI Registration", "FSSAI Central License",
          "FSSAI State License", "FSSAI Product Approval",
          "FSSAI License Renewal", "Halal Certification",
        ],
      },
      {
        title: "Business Certifications",
        links: [
          "RERA Registration", "NSIC Registration", "PESO Certificate",
          "BEE Registration", "Make In India Certificate",
          "APEDA Registration", "CE Certification", "CMMI Certification",
        ],
      },
      {
        title: "International Business",
        links: [
          "Company in Dubai", "UK Company Registration",
          "Singapore Company Registration", "USA Company Registration",
          "Canada Company Registration", "Australia Company Registration",
          "Germany Company Registration", "Dubai Free Zone",
        ],
      },
      {
        title: "Trade License & Other",
        links: [
          "Trade License", "Gumasta License", "IEC Registration",
          "Digital Signature Certificate", "BIS Certification",
          "Barcode Registration",
        ],
      },
      {
        title: "NGO",
        links: [
          "Section 8 Company Registration", "Darpan Registration",
          "12A and 80G Registration", "FCRA Registration", "NGO Accounting",
        ],
      },
    ],
  },
  {
    label: "Compliance",
    sections: [
      {
        title: "Company Compliance",
        links: [
          "MSME Registration", "EPF Registration",
          "Shop & Establishment Registration",
        ],
      },
      {
        title: "Annual Compliance",
        links: [
          "LLP Annual Compliance", "Private Limited Company Compliance",
          "Nidhi Company Compliance", "NGO Compliance",
          "Society Annual Compliance", "Partnership Firm Compliance",
          "Trust Annual Compliance", "Bookkeeping Services",
        ],
      },
      {
        title: "MCA Services",
        links: [
          "Change Company Name", "Close Private Limited",
          "Change Registered Office", "Change in Director",
          "DIR-3 KYC for Directors", "Add Designated Partner",
          "Revival of Struck Off Companies", "Change in Object Clause",
        ],
      },
      {
        title: "Event Based Compliance",
        links: [
          "Winding Up of Company", "Director Appointment",
          "Increase Authorized Capital", "Removal of Director",
          "Change of Auditor", "Issue of Shares", "Transfer of Shares",
        ],
      },
      {
        title: "Convert Your Business",
        links: [
          "Partnership to LLP", "Appointment of Auditor", "Form INC-20A",
        ],
      },
    ],
  },
  {
    label: "IPR",
    sections: [
      {
        title: "Trademark Registration",
        links: [
          "Trademark Registration", "Trademark Renewal",
          "Trademark Opposition", "International Trademark Registration",
          "Trademark Rectification", "Trademark Registration for E-commerce",
          "Trademark Hearing", "Response to Trademark Objection",
          "Trademark Infringement", "Trademark Assignment",
          "Trademark Objection",
        ],
      },
      {
        title: "Copyright Registration",
        links: ["Copyright Registration"],
      },
      {
        title: "Patent Registration",
        links: ["Patent Registration"],
      },
      {
        title: "Design Registration",
        links: ["Design Registration"],
      },
      {
        title: "Intellectual Property Dispute",
        links: ["Intellectual Property Dispute"],
      },
    ],
  },
  {
    label: "Taxation",
    sections: [
      {
        title: "Income Tax",
        links: [
          "Income Tax Return Filing", "TDS Return Filing", "PF Return",
          "ITR 1 Form Filing", "ITR 2 Form Filing", "ITR 7 Form Filing",
          "80-IAC Tax Exemption",
        ],
      },
      {
        title: "Goods & Service Tax",
        links: [
          "GST Registration", "GST Return Filing", "GSTR9 Return",
          "Cancel GST Registration", "Virtual Place of Business in GST",
          "GST Registration for E-commerce", "Input Tax Credit",
          "GST E-Invoice", "E-Way Bill Registration",
        ],
      },
    ],
  },
  {
    label: "Consultation",
    sections: [
      {
        title: "CA Services",
        links: [
          "Online CA Services", "Mergers & Acquisitions",
          "Financial Consultancy Services", "Financial Modeling for Startups",
        ],
      },
      {
        title: "Business Consultants",
        links: [
          "Payment Gateway Solutions", "Startup Planning",
          "CSR Registration", "Pitch Deck for Startups",
        ],
      },
      {
        title: "Lawyer & Expert",
        links: [
          "Consumer Complaint", "Cheque Bounce Notice",
          "Legal Notice", "Legal Notice for Defamation",
        ],
      },
    ],
  },
  {
    label: "More",
    sections: [
      {
        title: "Environmental",
        links: [
          "Consent to Establish", "EPR Registration",
          "Environmental Auditing", "Plastic Waste Authorization",
          "EPR for E-Waste", "Environmental Impact Assessment",
          "ROHS Certification",
        ],
      },
      {
        title: "Agreements & Contracts",
        links: [
          "MOU", "Joint Venture Agreement", "Franchise Agreement",
          "Shareholders Agreement", "Founders Agreement",
          "Non-Disclosure Agreement", "Service Level Agreement",
          "Non-Compete Agreement", "Share Purchase Agreement",
        ],
      },
      {
        title: "Tools & Calculators",
        links: [
          "NIC Code", "Company Name Check", "Trademark Search",
          "Trademark Class Search", "GST Calculator",
          "SIP Calculator", "8th Pay Commission Calculator",
        ],
      },
      {
        title: "Regulatory",
        links: [
          "NBFC Registration", "NBFC Compliance",
          "Payment Bank License", "Payment Gateway License",
        ],
      },
      {
        title: "Resources & About",
        links: [
          "Blog", "Guides", "About Us",
          "Contact Us", "Reviews", "Explore Partnerships",
        ],
      },
    ],
  },
];

// ─── MEGA MENU (2-panel: left sidebar + right grid) ───────────────────────────
function MegaMenu({ navItem, onClose }) {
  const [activeSection, setActiveSection] = useState(0);
  const current = navItem.sections[activeSection];

  return (
    <div
      className="absolute top-full left-0 right-0 z-50 bg-white shadow-2xl border-t border-gray-200"
      style={{ boxShadow: "0 8px 40px rgba(0,0,0,0.13)" }}
    >
      <div className="max-w-screen-xl mx-auto flex" style={{ minHeight: 280 }}>

        {/* LEFT: Section sidebar */}
        <div className="w-56 shrink-0 bg-white border-r border-gray-100 py-3">
          {navItem.sections.map((section, i) => (
            <button
              key={i}
              className={`w-full text-left px-5 py-2.5 text-[13px] font-semibold transition-colors flex items-center justify-between group ${
                activeSection === i
                  ? "bg-orange-500 text-white"
                  : "text-gray-700 hover:bg-orange-50 hover:text-orange-600"
              }`}
              onMouseEnter={() => setActiveSection(i)}
              onClick={() => setActiveSection(i)}
            >
              <span>{section.title}</span>
              {activeSection === i && (
                <svg className="w-3.5 h-3.5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M9 5l7 7-7 7" />
                </svg>
              )}
            </button>
          ))}
        </div>

        {/* RIGHT: Links grid */}
        <div className="flex-1 p-6">
          <p className="text-[11px] font-extrabold text-orange-500 uppercase tracking-widest mb-4">
            {current.title}
          </p>
          <div
            className="grid gap-x-8 gap-y-1"
            style={{ gridTemplateColumns: "repeat(3, minmax(0, 1fr))" }}
          >
            {current.links.map((link, j) => (
              <a
                key={j}
                href={`https://www.registerkaro.in/${link.toLowerCase().replace(/\s+/g, "-")}`}
                target="_blank"
                rel="noopener noreferrer"
                className="text-[13px] text-gray-700 hover:text-orange-600 py-1.5 transition-colors border-b border-gray-50 hover:border-orange-100"
                onClick={onClose}
              >
                {link}
              </a>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}

// ─── MOBILE: 3-level accordion ────────────────────────────────────────────────
function MobileNavItem({ item, onClose }) {
  const [open, setOpen] = useState(false);
  const [openSection, setOpenSection] = useState(null);

  return (
    <div className="border-b border-gray-100">
      {/* Level 1 */}
      <button
        className={`w-full flex items-center justify-between px-5 py-4 text-sm font-bold transition-colors ${
          open ? "text-orange-500 bg-orange-50" : "text-gray-800 hover:bg-gray-50"
        }`}
        onClick={() => { setOpen((v) => !v); setOpenSection(null); }}
      >
        <span>{item.label}</span>
        <svg
          className={`w-4 h-4 transition-transform ${open ? "rotate-180 text-orange-400" : "text-gray-400"}`}
          fill="none" stroke="currentColor" viewBox="0 0 24 24"
        >
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
        </svg>
      </button>

      {open && (
        <div className="border-t border-gray-100 bg-gray-50">
          {item.sections.map((section, i) => (
            <div key={i} className="border-b border-gray-100 last:border-0">
              {/* Level 2 */}
              <button
                className={`w-full flex items-center justify-between px-6 py-3 text-[12px] font-bold transition-colors ${
                  openSection === i
                    ? "bg-orange-500 text-white"
                    : "text-gray-700 hover:bg-orange-50 hover:text-orange-600"
                }`}
                onClick={() => setOpenSection(openSection === i ? null : i)}
              >
                <span>{section.title}</span>
                <svg
                  className={`w-3.5 h-3.5 transition-transform ${openSection === i ? "rotate-90" : ""}`}
                  fill="none" stroke="currentColor" viewBox="0 0 24 24"
                >
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M9 5l7 7-7 7" />
                </svg>
              </button>

              {/* Level 3 */}
              {openSection === i && (
                <div className="bg-white px-6 py-3 grid grid-cols-2 gap-x-4 gap-y-0.5">
                  {section.links.map((link, j) => (
                    <a
                      key={j}
                      href={`https://www.registerkaro.in/${link.toLowerCase().replace(/\s+/g, "-")}`}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="text-[11.5px] text-gray-600 hover:text-orange-500 py-1 transition-colors"
                      onClick={onClose}
                    >
                      {link}
                    </a>
                  ))}
                </div>
              )}
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

// ─── MAIN NAVBAR ──────────────────────────────────────────────────────────────
export default function RegisterKaroNavbar() {
  const [activeNav, setActiveNav] = useState(null);
  const [mobileOpen, setMobileOpen] = useState(false);
  const [scrolled, setScrolled] = useState(false);
  const closeTimer = useRef(null);

  useEffect(() => {
    const onScroll = () => setScrolled(window.scrollY > 8);
    window.addEventListener("scroll", onScroll);
    return () => window.removeEventListener("scroll", onScroll);
  }, []);

  const handleEnter = (label) => {
    clearTimeout(closeTimer.current);
    setActiveNav(label);
  };

  const handleLeave = () => {
    closeTimer.current = setTimeout(() => setActiveNav(null), 120);
  };

  const activeItem = NAV_DATA.find((n) => n.label === activeNav);

  return (
    <div className="min-h-screen bg-gray-100">

      {/* ── Sticky Navbar ── */}
      <header
        className={`sticky top-0 z-40 w-full bg-white transition-shadow duration-200 ${
          scrolled ? "shadow-lg" : "shadow-sm"
        }`}
      >
        <div className="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex items-center justify-between h-[68px] gap-6">

            {/* Logo — matches screenshot: shield icon + RegisterKaro wordmark */}
            <a href="https://www.registerkaro.in" target="_blank" rel="noopener noreferrer"
              className="flex items-center gap-2 shrink-0">
              {/* Shield icon */}
              <svg className="w-9 h-9" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 2L4 8v10c0 8.5 5.9 16.4 14 18.9C26.1 34.4 32 26.5 32 18V8L18 2z" fill="#f97316"/>
                <path d="M13 18l3.5 3.5L23 14" stroke="white" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/>
              </svg>
              <span className="text-[20px] font-black text-gray-900 tracking-tight leading-none">
                Register<span className="text-orange-500">Karo</span>
              </span>
            </a>

            {/* Desktop Nav */}
            <nav className="hidden lg:flex items-stretch h-full flex-1">
              {NAV_DATA.map((item) => (
                <div
                  key={item.label}
                  className="relative h-full flex items-center"
                  onMouseEnter={() => handleEnter(item.label)}
                  onMouseLeave={handleLeave}
                >
                  <button
                    className={`flex items-center gap-1 px-3.5 h-full text-[14px] font-semibold transition-colors whitespace-nowrap ${
                      activeNav === item.label
                        ? "text-orange-500"
                        : "text-gray-800 hover:text-orange-500"
                    } ${item.label === "IPR" ? "text-orange-500" : ""}`}
                  >
                    {item.label}
                    <svg
                      className={`w-3 h-3 mt-0.5 transition-transform duration-150 ${
                        activeNav === item.label ? "rotate-180 text-orange-400" : "text-gray-400"
                      }`}
                      fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    >
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M19 9l-7 7-7-7" />
                    </svg>
                  </button>
                </div>
              ))}
            </nav>

            {/* Right actions */}
            <div className="hidden lg:flex items-center gap-3 shrink-0">
              {/* Search icon */}
              <button className="p-2 text-gray-500 hover:text-orange-500 transition-colors">
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
              </button>

              {/* Contact Us */}
              <a href="https://www.registerkaro.in/contact-us" target="_blank" rel="noopener noreferrer"
                className="text-[14px] font-semibold text-gray-800 hover:text-orange-500 transition-colors whitespace-nowrap">
                Contact Us
              </a>

              {/* Login */}
              <a href="https://portal.registerkaro.in" target="_blank" rel="noopener noreferrer"
                className="px-5 py-2 border border-gray-300 rounded-md text-[14px] font-semibold text-gray-800 hover:border-orange-400 hover:text-orange-500 transition-colors whitespace-nowrap">
                Login
              </a>

              {/* Talk to Experts */}
              <a href="tel:+919211993861"
                className="inline-flex items-center gap-2 px-5 py-2 bg-orange-500 hover:bg-orange-600 text-white text-[14px] font-bold rounded-md transition-colors whitespace-nowrap shadow-sm">
                <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                </svg>
                Talk to Experts
              </a>
            </div>

            {/* Mobile right */}
            <div className="lg:hidden flex items-center gap-2">
              <a href="tel:+919211993861"
                className="px-3 py-1.5 bg-orange-500 text-white text-xs font-bold rounded-md flex items-center gap-1">
                <svg className="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                </svg>
                Talk to Experts
              </a>
              <button
                className="p-2 rounded-md text-gray-600 hover:bg-gray-100 transition-colors"
                onClick={() => setMobileOpen((v) => !v)}
              >
                {mobileOpen
                  ? <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>
                  : <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" /></svg>
                }
              </button>
            </div>
          </div>
        </div>

        {/* ── Desktop Mega Menu ── */}
        {activeItem && (
          <div
            className="hidden lg:block absolute left-0 right-0 top-full"
            onMouseEnter={() => handleEnter(activeItem.label)}
            onMouseLeave={handleLeave}
          >
            <MegaMenu navItem={activeItem} onClose={() => setActiveNav(null)} />
          </div>
        )}

        {/* ── Mobile Menu ── */}
        {mobileOpen && (
          <div className="lg:hidden bg-white border-t border-gray-100 overflow-y-auto shadow-xl" style={{ maxHeight: "82vh" }}>
            {NAV_DATA.map((item) => (
              <MobileNavItem key={item.label} item={item} onClose={() => setMobileOpen(false)} />
            ))}
            <div className="px-5 py-5 space-y-3 border-t border-gray-100 bg-gray-50">
              <div className="flex gap-3">
                <a href="https://portal.registerkaro.in" target="_blank" rel="noopener noreferrer"
                  className="flex-1 py-2.5 border border-gray-300 text-gray-800 text-sm font-bold rounded-md text-center hover:border-orange-400 hover:text-orange-500 transition-colors">
                  Login
                </a>
                <a href="https://www.registerkaro.in/contact-us" target="_blank" rel="noopener noreferrer"
                  className="flex-1 py-2.5 bg-orange-500 text-white text-sm font-bold rounded-md text-center hover:bg-orange-600 transition-colors">
                  Contact Us
                </a>
              </div>
            </div>
          </div>
        )}
      </header>

      {/* Overlay */}
      {activeNav && (
        <div className="fixed inset-0 z-30 bg-black/10" onClick={() => setActiveNav(null)} />
      )}

      {/* ── Demo page content ── */}
      <main className="max-w-4xl mx-auto px-6 py-24 text-center">
        <div className="inline-flex items-center gap-2 bg-orange-100 text-orange-700 text-xs font-bold px-4 py-1.5 rounded-full mb-6 tracking-wide uppercase">
          ✨ Exact RegisterKaro Style
        </div>
        <h1 className="text-4xl md:text-5xl font-black text-gray-900 leading-tight mb-4">
          2-Panel Mega Menu<br />
          <span className="text-orange-500">Left Sidebar + Right Grid</span>
        </h1>
        <p className="text-gray-500 text-lg max-w-xl mx-auto mb-10">
          Hover any nav item to see the exact RegisterKaro-style mega menu — left sidebar highlights the active category in orange, right side shows the links in a 3-column grid.
        </p>
        <div className="grid grid-cols-2 sm:grid-cols-3 gap-3 max-w-lg mx-auto text-left">
          {[
            ["Left sidebar + right grid", "Exact same 2-panel layout"],
            ["Orange active highlight", "Matches the screenshot exactly"],
            ["Hover to switch sections", "Left sidebar on mouse-enter"],
            ["3-col link grid", "Right panel in columns"],
            ["Mobile 3-level accordion", "Fully responsive"],
            ["Sticky + scroll shadow", "Header stays on top"],
          ].map(([title, desc]) => (
            <div key={title} className="px-4 py-3 bg-white border border-gray-200 rounded-xl shadow-sm">
              <div className="text-xs font-bold text-gray-800">✓ {title}</div>
              <div className="text-[11px] text-gray-400 mt-0.5">{desc}</div>
            </div>
          ))}
        </div>
      </main>
    </div>
  );
}